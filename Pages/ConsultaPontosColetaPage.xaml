<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Rba.Pages.ConsultaPontosColetaPage"
             Title="Pontos de Coleta">

    <!-- Grid com 3 linhas: ações (Auto), busca/título (Auto), lista (*) -->
    <Grid Padding="30" RowDefinitions="Auto,Auto,*" RowSpacing="15">

        <!-- Ações -->
        <HorizontalStackLayout Grid.Row="0" HorizontalOptions="End" Spacing="10">
            <Button Text="Voltar"
              Clicked="Button_Voltar"
              Background="{StaticResource PrimaryBrush}"
              TextColor="{StaticResource White}" />

            <Button Text="Consultar"
              Clicked="Button_Consultar"
              Background="{StaticResource PrimaryBrush}"
              TextColor="{StaticResource White}"/>

            <Button Text="Registrar" 
              Clicked="Button_Registrar"
              Background="{StaticResource PrimaryBrush}"
              TextColor="{StaticResource White}"
              IsVisible="{Binding IsMaster}"/>
        </HorizontalStackLayout>

        <!-- Busca + título -->
        <VerticalStackLayout Grid.Row="1" Spacing="10">
            <Entry x:Name="BuscarEntry"
             Placeholder="Clique em consultar para consultar todos e depois o termo que deseja buscar..."
             TextChanged="OnBuscarTextChanged"
             BackgroundColor="White"
             FontSize="12"
             TextColor="Black"/>

            <Label Text="Pontos de Coleta Cadastrados"
             TextColor="{StaticResource Primary}"
             FontAttributes="Bold"
             FontSize="Medium"
             HorizontalOptions="Center" />
        </VerticalStackLayout>

        <!-- Lista -->
        <CollectionView x:Name="listaView"
                    Grid.Row="2"
                    SelectionMode="None"
                    VerticalOptions="FillAndExpand">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border BackgroundColor="#2E7D32"
                  Stroke="LightGray"
                  StrokeThickness="1"
                  Margin="5"
                  Padding="10">

                        <VerticalStackLayout Spacing="2">
                            <Label Text="{Binding Nome}" FontAttributes="Bold" TextColor="White" />
                            <Label Text="{Binding Endereco}" TextColor="White" />
                            <Label Text="{Binding TipoLixo}" TextColor="White" />
                            <Label Text="{Binding Contato}" TextColor="White" />
                            <Label Text="{Binding Horario}" FontSize="12" TextColor="White" />

                            <HorizontalStackLayout HorizontalOptions="Start" Spacing="10" Margin="0,4,0,0">
                                <Button Text="Ver no mapa"
                        BackgroundColor="GreenYellow"
                        TextColor="Black"
                        CornerRadius="8"
                        WidthRequest="150"
                        Clicked="OnAbrirMapaClicked"
                        BindingContext="{Binding .}"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentPage>
